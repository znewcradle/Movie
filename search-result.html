<!DOCTYPE html>
<html lang="en">
<head>
    <title>Search Result</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 引入 Bootstrap -->
    <link href="script/bootstrap.min.css" rel="stylesheet">
    <!-- 引入动画CSS -->
    <link href="style/animate.css" rel="stylesheet">
    <!-- 引入main.css -->
    <link href="style/search.css" rel="stylesheet">
    <link href="style/main.css" rel="stylesheet">
    <!-- 引入Vue.js -->
    <script src="script/vue.js"></script>
</head>
<body>
<div class="header fixed-header">
    <div class="header-logo">
        <a href="index.html">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
                <path d="M36 8l4 8h-6l-4-8h-4l4 8h-6l-4-8h-4l4 8h-6l-4-8H8c-2.21 0-3.98 1.79-3.98 4L4 36c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V8h-8z"></path>
            </svg>
            <span>Movie-Finder</span>
        </a>
    </div>
    <div class="header-navigation">
        <a>TOP榜单</a>
        <a>类型</a>
    </div>
    <div class="header-search-bar">
        <div class="cntr">
            <div class="cntr-innr">
                <label class="search" for="inpt_search">
                    <input id="inpt_search" type="text" placeholder="电影/影人/导演"/>
                </label>
            </div>
        </div>
    </div>
    <div class="header-user-entrance">
        <a data-toggle="modal" data-target="#loginModal">
            <span class="glyphicon glyphicon-user"></span>登陆
        </a>
        <span>|</span>
        <a data-toggle="modal" data-target="#registerModal">
            <span class="glyphicon glyphicon-log-in"></span>注册
        </a>
    </div>
    <div class="heading user-entrance after-login" hidden>
        <span class="user-profile">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><path
                    d="M24 24c4.42 0 8-3.59 8-8 0-4.42-3.58-8-8-8s-8 3.58-8 8c0 4.41 3.58 8 8 8zm0 4c-5.33 0-16 2.67-16 8v4h32v-4c0-5.33-10.67-8-16-8z"></path></svg>
        </span>
        <span class="user-name">
        </span>
        <span class="glyphicon glyphicon-log-out log-out"></span>
    </div>
</div>

<div class="main">
    <!-- loading effect -->
    <div id="fountainG">
        <div id="fountainG_1" class="fountainG"></div>
        <div id="fountainG_2" class="fountainG"></div>
        <div id="fountainG_3" class="fountainG"></div>
        <div id="fountainG_4" class="fountainG"></div>
        <div id="fountainG_5" class="fountainG"></div>
        <div id="fountainG_6" class="fountainG"></div>
        <div id="fountainG_7" class="fountainG"></div>
        <div id="fountainG_8" class="fountainG"></div>
    </div>
    <div class="movie-person" id="movie_director">
        <h3>导演</h3>
        <table class="movie director" v-for="director in directors">
            <tbody>
            <tr class="item">
                <td class="poster">
                    <!-- 图片 -->
                    <img src="images/test.jpg"/>
                </td>
                <td class="content">
                    <div>
                        <div class="title">
                            <span class="person-title" v-bind:data-director="director.directorId">{{ director.directorName }}</span>
                        </div>
                        <div class="detail">
                            <span class="glyphicon glyphicon-facetime-video"></span>
                            <span class="movie-director">导演</span>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="movie-person" id="movie_actor">
        <h3>演员</h3>
        <table class="movie actor" v-for="actor in actors">
            <tbody>
            <tr class="item">
                <td class="poster">
                    <!-- 图片 -->
                    <img src="images/test.jpg"/>
                </td>
                <td class="content">
                    <div>
                        <div class="title">
                            <span class="person-title" v-bind:data-actor="actor.actorId">{{ actor.actorName }}</span>
                        </div>
                        <div class="detail">
                            <span class="glyphicon glyphicon-th-list"></span>
                            <span class="movie-actors">演员</span>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="movie-list" id="movie_list">
        <h3>电影</h3>
        <table class="movie" v-for="mov in movies">
            <tbody>
            <tr class="item">
                <td class="poster">
                    <!-- 图片 -->
                    <img src="images/test.jpg"/>
                </td>
                <td class="content">
                    <div>
                        <div class="title">
                            <span class="movie-title" v-bind:data-movie="mov.movieId">{{ mov.movieName }}</span>
                        </div>
                        <div class="detail">
                            <!--信息 -->
                            <span class="glyphicon glyphicon-time"></span>
                            <span class="release-date">{{ mov.releaseDate | formatDate }}</span>
                            <span class="glyphicon glyphicon-bookmark"></span>
                            <span class="movie-type">
                                <template v-for="(tag,index) in mov.genres">
                                    <span v-if="index != mov.genres.length - 1"> {{ tag }}/</span>
                                    <span v-else>{{ tag }}&nbsp;</span>
                                </template>
                            </span>
                            <span class="glyphicon glyphicon-facetime-video"></span>
                            <span class="movie-director">
                                <!--<span v-bind:data-director="mov.directors[0].directorId">{{ mov.directors[0].directorName }}/</span>-->
                                <!--<span v-bind:data-director="mov.directors[1].directorId">{{ mov.directors[1].directorName }}</span>-->
                                <template v-for="(director, index) in mov.directors">
                                    <span v-bind:data-director="director.directorId"
                                          v-if="index != mov.directors.length - 1">{{  director.directorName }}/</span>
                                    <span v-bind:data-director="director.directorId" v-else>{{ director.directorName }}&nbsp;</span>
                                </template>
                            </span>
                            <span class="glyphicon glyphicon-th-list"></span>
                            <span class="movie-actors">
                                <!--<span v-bind:data-actor="mov.actors[0].actorId">{{ mov.actors[0].actorName }}/ </span>-->
                                <!--<span v-bind:data-actor="mov.actors[1].actorId">{{ mov.actors[1].actorName }}/</span>-->
                                <!--<span v-bind:data-actor="mov.actors[2].actorId">{{ mov.actors[2].actorName }}</span>-->
                                <template v-for="(star, index)  in mov.starActors">
                                    <span v-bind:data-actor="star.actorId" v-if="index != mov.starActors.length - 1">{{  star.actorName }}/</span>
                                    <span v-bind:data-actor="star.actorId" v-else>{{ star.actorName }}</span>
                                </template>
                            </span>
                        </div>
                        <div class="star">
                            <div class="allstar">
                                <ul>
                                    <!--<li class="glyphicon glyphicon-star"></li>-->
                                    <!--<li class="glyphicon glyphicon-star"></li>-->
                                    <!--<li class="glyphicon glyphicon-star"></li>-->
                                    <!--<li class="full-empty-star"></li>-->
                                    <!--<li class="glyphicon glyphicon-star-empty"></li>-->
                                </ul>
                                <!-- 星星-->
                            </div>
                            <span class="rating_nums">{{ mov.score }}<!-- 分数--></span>
                        </div>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="tag-list">
        <!-- glyphicon glyphicon-tag -->
        <!-- glyphicon glyphicon-bookmark -->
        <h4>在搜索结果中搜索</h4>
        <h5>年份</h5>
        <ul class="movie-type">
            <li>
                <span class="glyphicon glyphicon-tag"></span>
                <span>1996</span>
            </li>
            <li>
                <span class="glyphicon glyphicon-tag"></span>
                <span>1997</span>
            </li>
            <li>
                <span class="glyphicon glyphicon-tag"></span>
                <span>1998</span>
            </li>
        </ul>
        <h5>类型</h5>
        <ul class="movie-year">
            <li>
                <span class="glyphicon glyphicon-bookmark"></span>
                <span>喜剧</span>
            </li>
            <li>
                <span class="glyphicon glyphicon-bookmark"></span>
                <span>动作</span>
            </li>
            <li>
                <span class="glyphicon glyphicon-bookmark"></span>
                <span>悲剧</span>
            </li>
            <li>
                <span class="glyphicon glyphicon-bookmark"></span>
                <span>剧情</span>
            </li>
        </ul>
    </div>
</div>

<!-- BEGIN: modal -->
<div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <div class="modal-logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
                        <path d="M36 8l4 8h-6l-4-8h-4l4 8h-6l-4-8h-4l4 8h-6l-4-8H8c-2.21 0-3.98 1.79-3.98 4L4 36c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V8h-8z"></path>
                    </svg>
                    <span>Movie-Finder</span>
                </div>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <span class="glyphicon glyphicon-user input-group-addon"></span>
                    <input type="text" class="form-control" name="login-name" id="login-name" placeholder="用户名"/>
                </div>
                <div class="input-group">
                    <span class="glyphicon glyphicon-pencil input-group-addon"></span>
                    <input type="password" class="form-control" name="login-pwd" id="login-pwd" placeholder="您的密码"/>
                </div>
                <div class="error-message login" hidden></div>
            </div>
            <div class="modal-footer">
                <div class="modal-btn-footer" id="login_btn">登陆</div>
            </div>
        </div><!-- END: /.modal-content -->
    </div><!-- END:  login-modal -->
</div>

<div class="modal fade" id="registerModal" tabindex="-2" role="dialog" aria-labelledby="registerLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <div class="modal-logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
                        <path d="M36 8l4 8h-6l-4-8h-4l4 8h-6l-4-8h-4l4 8h-6l-4-8H8c-2.21 0-3.98 1.79-3.98 4L4 36c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V8h-8z"></path>
                    </svg>
                    <span>Movie-Finder</span>
                </div>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <span class="glyphicon glyphicon-user input-group-addon"></span>
                    <input type="text" class="form-control" name="register-name" id="register-name" placeholder="用户名"/>
                </div>
                <div class="input-group">
                    <span class="glyphicon glyphicon-pencil input-group-addon"></span>
                    <input type="password" class="form-control" name="register-pwd" id="register-pwd"
                           placeholder="您的密码"/>
                </div>
                <div class="input-group">
                    <span class="glyphicon glyphicon-ok input-group-addon"></span>
                    <input type="password" class="form-control" name="registser-re-pwd" id="register-re-pwd"
                           placeholder="请确认您的密码"/>
                </div>
                <div class="error-message register" hidden></div>
            </div>
            <div class="modal-footer">
                <div class="modal-btn-footer" id="register_btn">注册</div>
            </div>
        </div><!-- END: modal-content -->
    </div>
</div><!-- END: register modal -->
<!-- END: modal -->

<!-- 引入jQuery -->
<script src="script/jquery.min.js"></script>
<!-- 引入bootstrap.min.js -->
<script src="script/bootstrap.min.js"></script>
<!-- 引入自定义JS -->
<script src="script/main.js"></script>
<script>
    var $loading = $("#fountaionG");
    $loading.show();

    var objKey = getParams();
    var keyword = objKey["key"];
    $.ajax({
        type: 'get',
        url: 'http://localhost:1189/api/movies/search',
        data: {
            searchText: keyword
        },
        beforeSend: function (XMLHttpRequest) {
            var token = localStorage.getItem("token");
            var token_type = localStorage.getItem("token_type");
            XMLHttpRequest.setRequestHeader("Authorization", token_type + " " + token);
        },
        success: function (data, textStatus) {
            var movies = data['movies'];
            var directors = data['directors'];
            var actors = data['actors'];

            console.log(JSON.stringify(directors));

            Vue.filter('formatDate', function (input) {
                if (!input) return " ";
                var year = input.slice(0, 4);
                var month = input.slice(4, 6);
                var day = input.slice(6, 8);
                return year + "-" + month + "-" + day;
            });

            var mdirector = new Vue({
                el: '#movie_director',
                data: {
                    directors: directors
                }
            });
            var mactor = new Vue({
                el: '#movie_actor',
                data: {
                    actors: actors
                }
            });
            var mmovie = new Vue({
                el: '#movie_list',
                data: {
                    movies: movies
                },
                computed: {
                    releaseDate: function () {

                    }
                }
            });

            var $starList = $("div.allstar ul");

            $starList.each(function (index) {
                var score = Math.floor(movies[index].score);
                var over = Math.ceil(movies[index].score);
                var empty = 5;

                for (var j = 0; j < score; ++j) {
                    $(this).append('<li class="glyphicon glyphicon-star"></li>');
                }
                if (score == 5) {
                    return;
                } else if (score !== over) {
                    $(this).append('<li class="full-empty-star"></li>');
                    empty = 4;
                }

                for (var k = j; k < empty; ++k) {
                    $(this).append('<li class="glyphicon glyphicon-star-empty"></li>');
                }
            });
            $("li.full-empty-star").append(' <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" t="1496747430879" class="icon" viewBox="0 0 1026 1024" version="1.1" p-id="1428" width="200.390625" height="200"><defs></defs><path d="M512.275763 112.128l112.64 228.352c11.776 24.064 34.816 40.96 61.44 44.544l252.416 36.864-182.784 178.176c-19.456 18.944-28.16 45.568-23.552 72.192l43.008 251.392-225.792-118.784c-11.776-6.144-24.576-9.216-37.888-9.216-13.312 0-26.112 3.072-37.888 9.216l-225.792 118.784 43.008-251.392c4.608-26.624-4.096-53.248-23.552-72.192L85.779763 421.888 338.195763 385.536c26.624-4.096 49.664-20.48 61.44-44.544L512.275763 112.128M512.275763 23.552c-9.728 0-19.456 5.12-24.576 15.36L350.995763 316.928c-4.096 8.192-11.776 13.824-20.48 14.848L23.315763 376.32c-22.528 3.072-31.232 30.72-14.848 46.08L230.675763 638.976c6.656 6.144 9.216 15.36 7.68 24.064l-52.224 305.664c-3.072 17.408 10.752 31.744 26.624 31.744 4.096 0 8.704-1.024 12.8-3.072l274.432-144.384c4.096-2.048 8.192-3.072 12.8-3.072 4.096 0 8.704 1.024 12.8 3.072l274.432 144.384c4.096 2.048 8.704 3.072 12.8 3.072 15.872 0 29.696-14.336 26.624-31.744l-52.224-305.664c-1.536-8.704 1.536-17.92 7.68-24.064l222.208-216.576c15.872-15.872 7.168-43.008-14.848-46.08l-306.688-44.544c-8.704-1.536-16.384-6.656-20.48-14.848L536.851763 38.912C531.731763 28.672 522.003763 23.552 512.275763 23.552L512.275763 23.552z" p-id="1429"/><path d="M487.699763 38.912 350.995763 316.928c-4.096 8.192-11.776 13.824-20.48 14.848L23.315763 376.32c-22.528 3.072-31.232 30.72-14.848 46.08L230.675763 638.976c6.656 6.144 9.216 15.36 7.68 24.064l-52.224 305.664c-3.584 22.016 19.456 38.912 39.424 28.672l274.432-144.384c4.096-2.048 7.168-3.072 12.8-3.072L512.787763 23.552C501.523763 23.552 492.819763 28.672 487.699763 38.912z" p-id="1430"/></svg>');

            $loading.prop("hidden", false);
        },
        error: function () {

        }
    });
</script>
</body>
</html>